<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Overload</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@400;600;700&family=Outfit:wght@300;400;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --bg: #0a0a0b;
  --surface: #141416;
  --surface2: #1c1c20;
  --border: #2a2a30;
  --text: #e8e8ec;
  --text2: #8a8a96;
  --accent: #4ade80;
  --accent2: #22c55e;
  --red: #f87171;
  --orange: #fb923c;
  --blue: #60a5fa;
  --radius: 14px;
}

* { margin: 0; padding: 0; box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

body {
  font-family: 'Outfit', sans-serif;
  background: var(--bg);
  color: var(--text);
  min-height: 100dvh;
  max-width: 480px;
  margin: 0 auto;
  padding: 0 16px 100px;
  overflow-x: hidden;
}

/* Header */
.header {
  padding: 20px 0 8px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.header h1 {
  font-family: 'JetBrains Mono', monospace;
  font-size: 22px;
  font-weight: 700;
  letter-spacing: -0.5px;
  background: linear-gradient(135deg, var(--accent), var(--blue));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
}
.header-actions { display: flex; gap: 8px; }
.icon-btn {
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text2);
  width: 38px;
  height: 38px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 16px;
  transition: all 0.2s;
}
.icon-btn:active { transform: scale(0.93); background: var(--surface2); }

/* Tab nav */
.tabs {
  display: flex;
  gap: 6px;
  padding: 12px 0;
  overflow-x: auto;
  scrollbar-width: none;
}
.tabs::-webkit-scrollbar { display: none; }
.tab {
  padding: 8px 18px;
  border-radius: 100px;
  background: var(--surface);
  border: 1px solid var(--border);
  color: var(--text2);
  font-family: 'Outfit', sans-serif;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  white-space: nowrap;
  transition: all 0.2s;
}
.tab.active {
  background: var(--accent);
  color: var(--bg);
  border-color: var(--accent);
}
.tab:active { transform: scale(0.95); }

/* View toggle */
.view-toggle {
  display: flex;
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 10px;
  margin: 8px 0 16px;
  overflow: hidden;
}
.view-btn {
  flex: 1;
  padding: 10px;
  text-align: center;
  font-family: 'Outfit', sans-serif;
  font-size: 13px;
  font-weight: 600;
  color: var(--text2);
  background: none;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
}
.view-btn.active {
  background: var(--surface2);
  color: var(--text);
}

/* Cards */
.card {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  margin-bottom: 12px;
}
.card-title {
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 12px;
  display: flex;
  justify-content: space-between;
  align-items: center;
}
.card-title .last-weight {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--text2);
  font-weight: 400;
}

/* Set rows */
.sets-container { display: flex; flex-direction: column; gap: 8px; }
.set-row {
  display: flex;
  gap: 8px;
  align-items: center;
}
.set-label {
  font-family: 'JetBrains Mono', monospace;
  font-size: 11px;
  color: var(--text2);
  width: 20px;
  text-align: center;
  flex-shrink: 0;
}
.set-input {
  flex: 1;
  background: var(--surface2);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 10px 12px;
  color: var(--text);
  font-family: 'JetBrains Mono', monospace;
  font-size: 15px;
  text-align: center;
  outline: none;
  width: 100%;
  transition: border-color 0.2s;
}
.set-input:focus { border-color: var(--accent); }
.set-input::placeholder { color: #444; }
.input-group { flex: 1; display: flex; flex-direction: column; gap: 2px; }
.input-label {
  font-size: 10px;
  color: var(--text2);
  text-align: center;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}
.remove-set {
  width: 28px;
  height: 28px;
  border-radius: 6px;
  background: none;
  border: 1px solid transparent;
  color: var(--text2);
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 16px;
  flex-shrink: 0;
  transition: all 0.15s;
}
.remove-set:active { background: rgba(248,113,113,0.15); color: var(--red); border-color: var(--red); }

.add-set-btn {
  width: 100%;
  padding: 8px;
  border-radius: 8px;
  background: none;
  border: 1px dashed var(--border);
  color: var(--text2);
  font-family: 'Outfit', sans-serif;
  font-size: 13px;
  cursor: pointer;
  margin-top: 4px;
  transition: all 0.2s;
}
.add-set-btn:active { border-color: var(--accent); color: var(--accent); }

/* Save button */
.save-bar {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  padding: 12px 16px calc(12px + env(safe-area-inset-bottom));
  background: linear-gradient(to top, var(--bg) 70%, transparent);
  z-index: 100;
  display: flex;
  justify-content: center;
}
.save-btn {
  width: 100%;
  max-width: 448px;
  padding: 16px;
  border-radius: 14px;
  background: var(--accent);
  color: var(--bg);
  font-family: 'Outfit', sans-serif;
  font-size: 16px;
  font-weight: 700;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  letter-spacing: -0.3px;
}
.save-btn:active { transform: scale(0.97); background: var(--accent2); }
.save-btn:disabled { opacity: 0.3; }

/* Chart */
.chart-container {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  padding: 16px;
  margin-bottom: 12px;
}
.chart-title {
  font-size: 15px;
  font-weight: 600;
  margin-bottom: 4px;
}
.chart-subtitle {
  font-size: 12px;
  color: var(--text2);
  margin-bottom: 12px;
}
.chart-wrapper { position: relative; height: 200px; }

/* History */
.history-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid var(--border);
}
.history-row:last-child { border-bottom: none; }
.history-date {
  font-family: 'JetBrains Mono', monospace;
  font-size: 12px;
  color: var(--text2);
}
.history-sets {
  font-size: 13px;
  color: var(--text);
  text-align: right;
}
.history-top {
  font-family: 'JetBrains Mono', monospace;
  font-size: 13px;
  font-weight: 600;
}
.pr-badge {
  display: inline-block;
  background: rgba(74, 222, 128, 0.15);
  color: var(--accent);
  font-size: 10px;
  font-weight: 700;
  padding: 2px 6px;
  border-radius: 4px;
  margin-left: 6px;
  font-family: 'JetBrains Mono', monospace;
}
.delete-entry {
  background: none;
  border: none;
  color: var(--text2);
  cursor: pointer;
  padding: 4px;
  font-size: 14px;
  opacity: 0.5;
  margin-left: 8px;
}
.delete-entry:active { opacity: 1; color: var(--red); }

/* Modal */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.7);
  z-index: 200;
  display: flex;
  align-items: flex-end;
  justify-content: center;
  opacity: 0;
  pointer-events: none;
  transition: opacity 0.2s;
}
.modal-overlay.open { opacity: 1; pointer-events: all; }
.modal {
  background: var(--surface);
  border: 1px solid var(--border);
  border-radius: 20px 20px 0 0;
  padding: 24px 20px calc(24px + env(safe-area-inset-bottom));
  width: 100%;
  max-width: 480px;
  transform: translateY(100%);
  transition: transform 0.3s ease;
}
.modal-overlay.open .modal { transform: translateY(0); }
.modal h3 { font-size: 18px; margin-bottom: 16px; }
.modal-btn {
  width: 100%;
  padding: 14px;
  border-radius: 12px;
  font-family: 'Outfit', sans-serif;
  font-size: 15px;
  font-weight: 600;
  border: 1px solid var(--border);
  background: var(--surface2);
  color: var(--text);
  cursor: pointer;
  margin-bottom: 8px;
  transition: all 0.15s;
}
.modal-btn:active { transform: scale(0.98); }
.modal-btn.danger { color: var(--red); border-color: rgba(248,113,113,0.3); }

/* Toast */
.toast {
  position: fixed;
  top: 20px;
  left: 50%;
  transform: translateX(-50%) translateY(-80px);
  background: var(--accent);
  color: var(--bg);
  padding: 12px 24px;
  border-radius: 100px;
  font-weight: 600;
  font-size: 14px;
  z-index: 300;
  transition: transform 0.3s ease;
  white-space: nowrap;
}
.toast.show { transform: translateX(-50%) translateY(0); }

/* Empty state */
.empty {
  text-align: center;
  padding: 48px 20px;
  color: var(--text2);
}
.empty-icon { font-size: 40px; margin-bottom: 12px; }
.empty p { font-size: 14px; line-height: 1.6; }

/* Hidden */
.hidden { display: none !important; }
</style>
</head>
<body>

<div class="toast" id="toast"></div>

<div class="header">
  <h1>OVERLOAD</h1>
  <div class="header-actions">
    <button class="icon-btn" onclick="openSettings()" title="Settings">‚öô</button>
  </div>
</div>

<div class="tabs" id="dayTabs"></div>

<div class="view-toggle">
  <button class="view-btn active" data-view="track" onclick="setView('track')">Track</button>
  <button class="view-btn" data-view="progress" onclick="setView('progress')">Progress</button>
  <button class="view-btn" data-view="history" onclick="setView('history')">History</button>
</div>

<!-- TRACK VIEW -->
<div id="trackView">
  <div id="exerciseCards"></div>
  <div class="save-bar">
    <button class="save-btn" onclick="saveWorkout()">Save Workout</button>
  </div>
</div>

<!-- PROGRESS VIEW -->
<div id="progressView" class="hidden"></div>

<!-- HISTORY VIEW -->
<div id="historyView" class="hidden"></div>

<!-- SETTINGS MODAL -->
<div class="modal-overlay" id="settingsModal">
  <div class="modal">
    <h3>Settings</h3>
    <button class="modal-btn" onclick="exportCSV()">üì§ Export All Data (CSV)</button>
    <label class="modal-btn" style="display:block;text-align:center;cursor:pointer;">
      üì• Import CSV
      <input type="file" accept=".csv" onchange="importCSV(event)" style="display:none;">
    </label>
    <button class="modal-btn" onclick="openEditConfig()">‚úèÔ∏è Edit Exercises</button>
    <button class="modal-btn danger" onclick="confirmClear()">üóë Clear All Data</button>
    <button class="modal-btn" onclick="closeSettings()" style="margin-top:8px;">Close</button>
  </div>
</div>

<!-- EDIT CONFIG MODAL -->
<div class="modal-overlay" id="editConfigModal">
  <div class="modal">
    <h3>Edit Workout Config</h3>
    <p style="font-size:13px;color:var(--text2);margin-bottom:12px;">JSON format. Edit days and exercises below:</p>
    <textarea id="configEditor" style="width:100%;height:200px;background:var(--surface2);border:1px solid var(--border);border-radius:10px;padding:12px;color:var(--text);font-family:'JetBrains Mono',monospace;font-size:12px;resize:vertical;outline:none;" spellcheck="false"></textarea>
    <button class="modal-btn" onclick="saveConfig()" style="margin-top:12px;background:var(--accent);color:var(--bg);border-color:var(--accent);">Save Config</button>
    <button class="modal-btn" onclick="closeEditConfig()">Cancel</button>
  </div>
</div>

<script>
// ‚îÄ‚îÄ Default workout config ‚îÄ‚îÄ
const DEFAULT_CONFIG = {
  "Push": ["Bench Press", "OHP", "Incline DB Press", "Lateral Raises", "Tricep Pushdown"],
  "Pull": ["Deadlift", "Barbell Row", "Lat Pulldown", "Face Pulls", "Barbell Curl"],
  "Legs": ["Squat", "Leg Press", "Romanian DL", "Leg Curl", "Calf Raise"]
};

// ‚îÄ‚îÄ State ‚îÄ‚îÄ
let config = JSON.parse(localStorage.getItem('ol_config')) || DEFAULT_CONFIG;
let data = JSON.parse(localStorage.getItem('ol_data')) || {};  // { "Push": [ { date, exercises: { "Bench Press": [{w,r},...] } }, ... ] }
let currentDay = Object.keys(config)[0];
let currentView = 'track';

// ‚îÄ‚îÄ Init ‚îÄ‚îÄ
function init() {
  renderTabs();
  renderView();
}

// ‚îÄ‚îÄ Tabs ‚îÄ‚îÄ
function renderTabs() {
  const el = document.getElementById('dayTabs');
  el.innerHTML = Object.keys(config).map(day =>
    `<button class="tab ${day === currentDay ? 'active' : ''}" onclick="selectDay('${day}')">${day}</button>`
  ).join('');
}

function selectDay(day) {
  currentDay = day;
  renderTabs();
  renderView();
}

// ‚îÄ‚îÄ Views ‚îÄ‚îÄ
function setView(view) {
  currentView = view;
  document.querySelectorAll('.view-btn').forEach(b => b.classList.toggle('active', b.dataset.view === view));
  document.getElementById('trackView').classList.toggle('hidden', view !== 'track');
  document.getElementById('progressView').classList.toggle('hidden', view !== 'progress');
  document.getElementById('historyView').classList.toggle('hidden', view !== 'history');
  document.querySelector('.save-bar').classList.toggle('hidden', view !== 'track');
  renderView();
}

function renderView() {
  if (currentView === 'track') renderTrack();
  else if (currentView === 'progress') renderProgress();
  else renderHistory();
}

// ‚îÄ‚îÄ TRACK VIEW ‚îÄ‚îÄ
function renderTrack() {
  const exercises = config[currentDay] || [];
  const dayData = data[currentDay] || [];
  const last = dayData[dayData.length - 1];

  document.getElementById('exerciseCards').innerHTML = exercises.map((ex, ei) => {
    const lastSets = last?.exercises?.[ex];
    const lastInfo = lastSets ? `Last: ${lastSets.map(s => s.w + '√ó' + s.r).join(', ')}` : 'No history';
    // Default 3 sets
    const numSets = 3;
    return `
      <div class="card" id="card-${ei}">
        <div class="card-title">
          ${ex}
          <span class="last-weight">${lastInfo}</span>
        </div>
        <div class="sets-container" id="sets-${ei}">
          ${Array.from({length: numSets}, (_, si) => setRowHTML(ei, si, lastSets?.[si])).join('')}
        </div>
        <button class="add-set-btn" onclick="addSet(${ei})">+ Add Set</button>
      </div>
    `;
  }).join('');
}

function setRowHTML(ei, si, prev) {
  const pw = prev ? prev.w : '';
  const pr = prev ? prev.r : '';
  return `
    <div class="set-row" data-ei="${ei}" data-si="${si}">
      <span class="set-label">${si + 1}</span>
      <div class="input-group">
        ${si === 0 ? '<span class="input-label">Weight</span>' : ''}
        <input class="set-input weight-input" type="number" inputmode="decimal" placeholder="${pw || '‚Äî'}" step="any">
      </div>
      <div class="input-group">
        ${si === 0 ? '<span class="input-label">Reps</span>' : ''}
        <input class="set-input reps-input" type="number" inputmode="numeric" placeholder="${pr || '‚Äî'}" step="1">
      </div>
      <button class="remove-set" onclick="removeSet(this)">√ó</button>
    </div>
  `;
}

function addSet(ei) {
  const container = document.getElementById(`sets-${ei}`);
  const count = container.querySelectorAll('.set-row').length;
  container.insertAdjacentHTML('beforeend', setRowHTML(ei, count, null));
}

function removeSet(btn) {
  const row = btn.closest('.set-row');
  const container = row.parentElement;
  if (container.querySelectorAll('.set-row').length > 1) {
    row.remove();
    // Re-number
    container.querySelectorAll('.set-row').forEach((r, i) => {
      r.querySelector('.set-label').textContent = i + 1;
    });
  }
}

// ‚îÄ‚îÄ SAVE ‚îÄ‚îÄ
function saveWorkout() {
  const exercises = config[currentDay] || [];
  const entry = { date: new Date().toISOString().split('T')[0], exercises: {} };
  let hasData = false;

  exercises.forEach((ex, ei) => {
    const card = document.getElementById(`card-${ei}`);
    if (!card) return;
    const rows = card.querySelectorAll('.set-row');
    const sets = [];
    rows.forEach(row => {
      const w = parseFloat(row.querySelector('.weight-input').value);
      const r = parseInt(row.querySelector('.reps-input').value);
      if (!isNaN(w) && !isNaN(r)) {
        sets.push({ w, r });
        hasData = true;
      }
    });
    if (sets.length) entry.exercises[ex] = sets;
  });

  if (!hasData) { toast('Enter at least one set'); return; }

  if (!data[currentDay]) data[currentDay] = [];
  data[currentDay].push(entry);
  localStorage.setItem('ol_data', JSON.stringify(data));
  toast('Workout saved ‚úì');
  renderTrack();
}

// ‚îÄ‚îÄ PROGRESS VIEW ‚îÄ‚îÄ
function renderProgress() {
  const exercises = config[currentDay] || [];
  const dayData = data[currentDay] || [];

  if (!dayData.length) {
    document.getElementById('progressView').innerHTML = `
      <div class="empty"><div class="empty-icon">üìä</div><p>No data yet for ${currentDay}.<br>Track a workout first!</p></div>`;
    return;
  }

  document.getElementById('progressView').innerHTML = exercises.map(ex => {
    const points = dayData
      .filter(d => d.exercises[ex])
      .map(d => {
        const sets = d.exercises[ex];
        const best = Math.max(...sets.map(s => s.w));
        const totalVol = sets.reduce((a, s) => a + s.w * s.r, 0);
        return { date: d.date, best, vol: totalVol };
      });

    if (!points.length) return '';

    const id = 'chart-' + ex.replace(/\s+/g, '-');
    return `
      <div class="chart-container">
        <div class="chart-title">${ex}</div>
        <div class="chart-subtitle">Best weight per session & total volume</div>
        <div class="chart-wrapper"><canvas id="${id}"></canvas></div>
      </div>
    `;
  }).join('');

  // Render charts
  exercises.forEach(ex => {
    const points = dayData.filter(d => d.exercises[ex]).map(d => {
      const sets = d.exercises[ex];
      return {
        date: d.date,
        best: Math.max(...sets.map(s => s.w)),
        vol: sets.reduce((a, s) => a + s.w * s.r, 0)
      };
    });
    if (!points.length) return;

    const id = 'chart-' + ex.replace(/\s+/g, '-');
    const canvas = document.getElementById(id);
    if (!canvas) return;

    new Chart(canvas, {
      type: 'line',
      data: {
        labels: points.map(p => p.date.slice(5)),
        datasets: [
          {
            label: 'Best Weight',
            data: points.map(p => p.best),
            borderColor: '#4ade80',
            backgroundColor: 'rgba(74,222,128,0.1)',
            tension: 0.3,
            fill: true,
            pointRadius: 4,
            pointBackgroundColor: '#4ade80',
            yAxisID: 'y'
          },
          {
            label: 'Volume',
            data: points.map(p => p.vol),
            borderColor: '#60a5fa',
            backgroundColor: 'rgba(96,165,250,0.08)',
            tension: 0.3,
            fill: true,
            pointRadius: 3,
            pointBackgroundColor: '#60a5fa',
            borderDash: [4, 4],
            yAxisID: 'y1'
          }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        interaction: { mode: 'index', intersect: false },
        plugins: {
          legend: { display: true, position: 'top', labels: { boxWidth: 12, padding: 12, color: '#8a8a96', font: { size: 11, family: 'Outfit' } } }
        },
        scales: {
          x: { ticks: { color: '#555', font: { size: 10, family: 'JetBrains Mono' } }, grid: { color: '#1c1c20' } },
          y: { position: 'left', ticks: { color: '#4ade80', font: { size: 10, family: 'JetBrains Mono' } }, grid: { color: '#1c1c20' } },
          y1: { position: 'right', ticks: { color: '#60a5fa', font: { size: 10, family: 'JetBrains Mono' } }, grid: { display: false } }
        }
      }
    });
  });
}

// ‚îÄ‚îÄ HISTORY VIEW ‚îÄ‚îÄ
function renderHistory() {
  const dayData = data[currentDay] || [];

  if (!dayData.length) {
    document.getElementById('historyView').innerHTML = `
      <div class="empty"><div class="empty-icon">üìã</div><p>No history for ${currentDay} yet.</p></div>`;
    return;
  }

  // Find all-time PRs per exercise
  const prs = {};
  dayData.forEach(d => {
    Object.entries(d.exercises).forEach(([ex, sets]) => {
      const best = Math.max(...sets.map(s => s.w));
      if (!prs[ex] || best > prs[ex]) prs[ex] = best;
    });
  });

  const rows = [...dayData].reverse().map((d, i) => {
    const exSummaries = Object.entries(d.exercises).map(([ex, sets]) => {
      const best = Math.max(...sets.map(s => s.w));
      const isPR = best === prs[ex] && dayData.filter(dd => {
        const b = dd.exercises[ex] ? Math.max(...dd.exercises[ex].map(s => s.w)) : 0;
        return b === prs[ex];
      })[0]?.date === d.date;
      return `<div style="margin-bottom:4px;">
        <span style="color:var(--text2);font-size:12px;">${ex}</span>
        <span class="history-top"> ${sets.map(s => s.w + '√ó' + s.r).join('  ')}</span>
        ${isPR ? '<span class="pr-badge">PR</span>' : ''}
      </div>`;
    }).join('');

    const realIdx = dayData.length - 1 - i;
    return `
      <div class="card">
        <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
          <span class="history-date">${d.date}</span>
          <button class="delete-entry" onclick="deleteEntry(${realIdx})" title="Delete">üóë</button>
        </div>
        ${exSummaries}
      </div>`;
  }).join('');

  document.getElementById('historyView').innerHTML = rows;
}

function deleteEntry(idx) {
  if (!confirm('Delete this entry?')) return;
  data[currentDay].splice(idx, 1);
  localStorage.setItem('ol_data', JSON.stringify(data));
  renderHistory();
  toast('Entry deleted');
}

// ‚îÄ‚îÄ CSV Export/Import ‚îÄ‚îÄ
function exportCSV() {
  let csv = 'day,date,exercise,set,weight,reps\n';
  Object.entries(data).forEach(([day, entries]) => {
    entries.forEach(entry => {
      Object.entries(entry.exercises).forEach(([ex, sets]) => {
        sets.forEach((s, si) => {
          csv += `"${day}","${entry.date}","${ex}",${si + 1},${s.w},${s.r}\n`;
        });
      });
    });
  });
  const blob = new Blob([csv], { type: 'text/csv' });
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `overload-${new Date().toISOString().split('T')[0]}.csv`;
  a.click();
  toast('CSV exported');
  closeSettings();
}

function importCSV(event) {
  const file = event.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = (e) => {
    try {
      const lines = e.target.result.trim().split('\n').slice(1); // skip header
      const imported = {};
      lines.forEach(line => {
        const parts = line.match(/(".*?"|[^",]+)/g)?.map(s => s.replace(/"/g, '').trim());
        if (!parts || parts.length < 6) return;
        const [day, date, ex, set, w, r] = parts;
        if (!imported[day]) imported[day] = {};
        if (!imported[day][date]) imported[day][date] = {};
        if (!imported[day][date][ex]) imported[day][date][ex] = [];
        imported[day][date][ex].push({ w: parseFloat(w), r: parseInt(r) });
      });

      // Convert to our format
      Object.entries(imported).forEach(([day, dates]) => {
        if (!data[day]) data[day] = [];
        Object.entries(dates).forEach(([date, exercises]) => {
          // Skip if we already have this exact date
          if (!data[day].find(d => d.date === date)) {
            data[day].push({ date, exercises });
          }
        });
        data[day].sort((a, b) => a.date.localeCompare(b.date));
      });

      localStorage.setItem('ol_data', JSON.stringify(data));
      toast('Data imported ‚úì');
      closeSettings();
      renderView();
    } catch (err) {
      toast('Import failed');
      console.error(err);
    }
  };
  reader.readAsText(file);
  event.target.value = '';
}

// ‚îÄ‚îÄ Config editing ‚îÄ‚îÄ
function openEditConfig() {
  closeSettings();
  document.getElementById('configEditor').value = JSON.stringify(config, null, 2);
  document.getElementById('editConfigModal').classList.add('open');
}
function closeEditConfig() { document.getElementById('editConfigModal').classList.remove('open'); }
function saveConfig() {
  try {
    const newConfig = JSON.parse(document.getElementById('configEditor').value);
    config = newConfig;
    localStorage.setItem('ol_config', JSON.stringify(config));
    currentDay = Object.keys(config)[0];
    closeEditConfig();
    renderTabs();
    renderView();
    toast('Config saved ‚úì');
  } catch (e) {
    toast('Invalid JSON');
  }
}

// ‚îÄ‚îÄ Settings modal ‚îÄ‚îÄ
function openSettings() { document.getElementById('settingsModal').classList.add('open'); }
function closeSettings() { document.getElementById('settingsModal').classList.remove('open'); }
function confirmClear() {
  if (confirm('Delete ALL workout data? This cannot be undone.')) {
    data = {};
    localStorage.removeItem('ol_data');
    closeSettings();
    renderView();
    toast('All data cleared');
  }
}

// Close modals on overlay click
document.querySelectorAll('.modal-overlay').forEach(el => {
  el.addEventListener('click', e => {
    if (e.target === el) el.classList.remove('open');
  });
});

// ‚îÄ‚îÄ Toast ‚îÄ‚îÄ
function toast(msg) {
  const el = document.getElementById('toast');
  el.textContent = msg;
  el.classList.add('show');
  setTimeout(() => el.classList.remove('show'), 2000);
}

// ‚îÄ‚îÄ Go ‚îÄ‚îÄ
init();
</script>
</body>
</html>
